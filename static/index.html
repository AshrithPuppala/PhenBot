<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PhenBOT Study Companion</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; margin: 0; padding: 24px; }
    #main { max-width: 640px; background: #fff; margin: 40px auto; padding: 32px; border-radius: 10px; box-shadow: 0 0 10px #ddd; }
    #messages { height: 320px; overflow-y: auto; border: 1px solid #ccc; padding: 1em; background: #fafafa; margin-bottom: 1em; }
    .user-msg { text-align: right; color: #1a73e8; margin: 5px 0; }
    .bot-msg { text-align: left; color: #333; background: #efefef; border-radius: 8px; padding: 8px; margin: 5px 0; display: inline-block; }
    #question { width: 70%; padding: 8px; }
    #sendBtn { padding: 8px 16px; }
  </style>
</head>
<body>
  <div id="main">
    <h2>PhenBOT Study Companion</h2>
    <div id="messages"></div>
    <input id="question" placeholder="Ask a study question..." autocomplete="off" />
    <button id="sendBtn" disabled>Send</button>
  </div>
  <script>
    const q = document.getElementById('question');
    const b = document.getElementById('sendBtn');
    const m = document.getElementById('messages');

    q.oninput = () => b.disabled = !q.value.trim();
    b.onclick = send;
    q.onkeypress = e => { if (e.key === 'Enter' && !b.disabled) send(); };

    function append(type, text) {
      let d = document.createElement('div');
      d.className = type;
      d.innerText = text;
      m.appendChild(d);
      m.scrollTop = m.scrollHeight;
    }

    async function send() {
      let text = q.value.trim();
      if (!text) return;
      append('user-msg', text);
      q.value = '';
      b.disabled = true;
      append('bot-msg', 'Thinking...');
      let nds = m.querySelector('.bot-msg:last-child');
      try {
       let r = await fetch('/api/ask', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ question: text })
});

        let j = await r.json();
        nds.remove();
        append('bot-msg', j.answer || j.error || 'No response.');
      } catch (e) {
        nds.remove();
        append('bot-msg', 'Server error.');
      }
      b.disabled = false;
    }
  </script>
</body>
</html>
