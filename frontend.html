<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PhenBot ~ AI Study Companion</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: 'Poppins', sans-serif;
  background: #000;
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* Canvas for galaxy animation */
canvas#galaxy {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
}

/* Header */
h1 {
  text-align: center;
  font-size: 2.5rem;
  font-weight: 800;
  color: #fff;
  text-shadow: 0 0 10px #fff, 0 0 20px #6a11cb, 0 0 30px #2575fc, 0 0 40px #fff;
  margin-bottom: 20px;
  z-index: 2;
  position: relative;
}

/* Chat container */
.chat-container {
  position: relative;
  z-index: 2;
  width: 90%;
  max-width: 700px;
  height: 70vh;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(15px);
  border-radius: 25px;
  box-shadow: 0 0 50px rgba(106,17,203,0.5);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-items: center;
  padding: 15px;
}

/* Chat area */
#chat {
  flex: 1;
  width: 100%;
  overflow-y: auto;
  padding: 10px;
}

/* Messages */
.message {
  margin: 10px 0;
  padding: 12px 16px;
  border-radius: 15px;
  max-width: 75%;
  line-height: 1.4;
  font-size: 15px;
  word-wrap: break-word;
  position: relative;
  animation: fadeIn 0.3s ease-in;
}

.message.user {
  background: rgba(37,117,252,0.9);
  align-self: flex-end;
  text-align: right;
  color: #fff;
  border-bottom-right-radius: 0px;
}

.message.bot {
  background: rgba(106,17,203,0.85);
  align-self: flex-start;
  text-align: left;
  color: #fff;
  border-bottom-left-radius: 0px;
}

.source {
  font-size: 12px;
  opacity: 0.8;
  margin-top: 6px;
}

/* Input bar */
.input-bar {
  width: 100%;
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

select, input, button {
  font-size: 15px;
  border-radius: 12px;
  border: none;
  padding: 12px;
  outline: none;
}

select, input {
  flex: 1;
}

button {
  background: linear-gradient(135deg, #6a11cb, #2575fc);
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}

button:hover {
  transform: scale(1.05);
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

::-webkit-scrollbar {
  width: 6px;
}
::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.4);
  border-radius: 10px;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>
<body>

<canvas id="galaxy"></canvas>

<div style="position:relative; z-index:2; width:100%; text-align:center;">
  <h1>PhenBot ~ AI Study Companion</h1>
</div>

<div class="chat-container">
  <div id="chat"></div>
  <div class="input-bar">
    <select id="subject">
      <option value="">All Subjects</option>
      <option value="math">Math</option>
      <option value="science">Science</option>
      <option value="programming">Programming</option>
    </select>
    <input type="file" id="pdfUpload" accept=".pdf" onchange="uploadPDF(event)" title="Upload PDF Reference">
    <input type="text" id="question" placeholder="Ask a question...">
    <button onclick="askQuestion()">Ask</button>
  </div>
</div>

<script>
/* === Galaxy Animation === */
const canvas = document.getElementById('galaxy');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let stars = [];
for (let i = 0; i < 300; i++) {
  stars.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    r: Math.random()*2 + 1.5,
    dx: (Math.random()-0.5)*0.3,
    dy: (Math.random()-0.5)*0.3,
    alpha: Math.random()
  });
}

// shooting stars
let shootingStars = [];
function createShootingStar() {
  shootingStars.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height/2,
    length: Math.random()*150 + 50,
    speed: Math.random()*5 + 5
  });
}

function drawGalaxy() {
  ctx.fillStyle = '#000';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // nebula effect
  let gradient = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 0, canvas.width/2, canvas.height/2, canvas.width);
  gradient.addColorStop(0, '#6a11cb22');
  gradient.addColorStop(0.5, '#2575fc22');
  gradient.addColorStop(1, '#000');
  ctx.fillStyle = gradient;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // draw stars
  stars.forEach(s => {
    ctx.beginPath();
    ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
    ctx.fillStyle = `rgba(255,255,255,${s.alpha})`;
    ctx.fill();
    s.x += s.dx;
    s.y += s.dy;
    s.alpha += (Math.random()-0.5)*0.02;
    if (s.alpha < 0) s.alpha=0;
    if (s.alpha > 1) s.alpha=1;
    if (s.x<0) s.x=canvas.width;
    if (s.x>canvas.width) s.x=0;
    if (s.y<0) s.y=canvas.height;
    if (s.y>canvas.height) s.y=0;
  });

  // draw shooting stars
  if (Math.random() < 0.01) createShootingStar();
  shootingStars.forEach((s,i)=>{
    ctx.beginPath();
    ctx.moveTo(s.x, s.y);
    ctx.lineTo(s.x-s.length, s.y+s.length);
    ctx.strokeStyle = "rgba(255,255,255,0.8)";
    ctx.lineWidth = 2;
    ctx.stroke();
    s.x += s.speed;
    s.y += s.speed;
    if(s.x>canvas.width || s.y>canvas.height) shootingStars.splice(i,1);
  });

  requestAnimationFrame(drawGalaxy);
}
drawGalaxy();

/* === Chat Functions === */
async function askQuestion() {
  const questionInput = document.getElementById('question');
  const question = questionInput.value.trim();
  if(!question) return;
  const subject = document.getElementById('subject').value;

  const chatDiv = document.getElementById('chat');
  chatDiv.innerHTML += `<div class="message user"><b>You:</b> ${question}</div>`;
  questionInput.value='';

  try {
    const res = await fetch('/ask',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({question})
    });
    const data = await res.json();
    let displayAnswer = data.answer || data.error || 'No answer';
    let source = data.source || (data.subject?'dataset':'Groq API');
    chatDiv.innerHTML += `<div class="message bot"><b>PhenBOT:</b> ${displayAnswer}<div class="source">Source: ${source}${data.confidence? ' | Confidence: '+data.confidence+'%':''}</div></div>`;
    chatDiv.scrollTop=chatDiv.scrollHeight;
  } catch(err){
    chatDiv.innerHTML += `<div class="message bot"><b>PhenBOT:</b> ‚ùå Error connecting to server</div>`;
  }
}

/* === PDF Upload === */
async function uploadPDF(event){
  const file = event.target.files[0];
  if(!file) return;
  const formData = new FormData();
  formData.append('pdf', file);
  const res = await fetch('/upload-pdf',{method:'POST', body:formData});
  const data = await res.json();
  alert(data.message || 'PDF uploaded!');
}

/* === Resize === */
window.addEventListener('resize',()=>{
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});
</script>
</body>
</html>
